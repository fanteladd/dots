# Autostart {{{

exec-once=systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP DISPLAY SWAYSOCK
exec-once=dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP=Hyprland
exec-once=xrandr --output XWAYLAND0 --primary

exec-once=hyprctl setcursor XCursor-Pro-Dark 24
exec-once=systemd-notify --ready --no-block
exec-once=s2dpr ~/.config/hypr/scripts/event_file
exec-once=import-gsettings

exec-once=foot --server
exec-once=systemctl --user restart dunst.service
exec-once=systemctl --user restart wayland-session.target
exec-once=waybar --config ~/.config/waybar/config-hypr.jsonc --style ~/.config/waybar/style.css

# }}}

# Variabels {{{

$term=kitty
$menu=rofi -no-lazy-grab -modi drun -show drun -drun-display-format \{name\} -theme launcher
# $menu=wofi --show drun --no-actions | xargs hyprctl dispatch exec --
$browser=env LIBVA_DRIVER_NAME=iHD firefox

# }}}

# Monitors {{{

monitor=eDP-1,preferred,3440x0,1,bitdepth,10
monitor=DP-1,preferred,0x0,1,bitdepth,10
# monitor=DP-1,1920x1080,auto,1,mirror,eDP-1,bitdepth,10

# }}}

# Input and gestures {{{

input {
  kb_layout=it,us
  kb_variant=
  kb_model=
  kb_options=grp:rctrl_toggle
  kb_rules=
  repeat_rate=50
  repeat_delay=300
  natural_scroll=1
  follow_mouse=1
  touchpad {
      natural_scroll=1
      tap-to-click=1
  }

}

gestures {
  workspace_swipe = true
  workspace_swipe_fingers = 3
  workspace_swipe_cancel_ratio = 0.15
  workspace_swipe_min_speed_to_force = 10
}

# }}}

# General {{{

general {
    sensitivity = 0.50

    gaps_in = 2
    gaps_out = 4
    border_size = 3
    col.active_border = rgba(BB9AF7FF)
    col.inactive_border = rgba(24283B66)
    cursor_inactive_timeout = 0
    col.group_border = rgba(77770066)
    col.group_border_active = rgba(FFFF0066)
    layout = dwindle

    resize_on_border = true
    hover_icon_on_border = true
    extend_border_grab_area = 15
    no_cursor_warps = true

    apply_sens_to_raw = false # do not apply the sensitivity to raw input (e.g. used by games where you aim)
}

# }}}

# Decoration and animations {{{

decoration {
  rounding=-1
  multisample_edges = true

  active_opacity=1.0
  inactive_opacity=1.0

  blur = true
  blur_size=4 # minimum 1
  blur_passes=1 # minimum 1, more passes = more resource intensive.
  blur_new_optimizations = true

  dim_inactive=1
  dim_strength=0.09

}


animations {
  enabled = true

  # bezier curve
  bezier = overshot, 0.05, 0.9, 0.1, 1.05
  # bezier = overshot, 0.13, 0.99, 0.29, 1.1
  bezier = smoothOut, 0.36, 0, 0.66, -0.56
  bezier = smoothIn, 0.25, 1, 0.5, 1
  # animation list
  animation = windows, 1, 5, overshot, slide
  animation = windowsOut, 1, 4, smoothOut, slide
  animation = windowsMove, 1, 4, default
  animation = border, 1, 10, default
  animation = fade, 1, 10, smoothIn
  animation = fadeDim, 1, 10, smoothIn
  animation = workspaces, 1, 6, overshot, slidevert
}

# Blurring layerSurfaces
layerrule = blur,gtk-layer-shell
layerrule = blur,notifications
layerrule = blur,lockscreen
layerrule = blur,rofi
layerrule = blur,waybar

# }}}

# Layout {{{

dwindle {
    pseudotile = true #enable pseudotiling on dwindle
    force_split = false
    use_active_for_splits = true
    preserve_split = true
}

# }}}

# Others {{{

misc {
    disable_hyprland_logo = true
    disable_splash_rendering = true
    mouse_move_enables_dpms = true
    vfr = true
    vrr = true
    disable_autoreload = true
    enable_swallow = false
    animate_manual_resizes = false
}

binds {
    scroll_event_delay=1
    allow_workspace_cycles=1
  }

# }}}

# Windows Rules {{{

windowrule = float, file_progress
windowrule = float, confirm
windowrule = float, dialog
windowrule = float, download
windowrule = float, notification
windowrule = float, error
windowrule = float, splash
windowrule = float, confirmreset
windowrule = float, title:lightone
windowrule=float,floating
windowrule=float,floating:1
windowrule=size 70% 70%,floating
windowrule=center,floating
windowrule = float,^(.*)(float)$
windowrule = float,^(.*)(menu)$
windowrule = pin,^(.*)(menu)$

windowrule=idleinhibit always,class:mpv
windowrule = idleinhibit fullscreen, firefox

# Telegram
windowrule=float,org.telegram.desktop
windowrule=animation popin 70%,org.telegram.desktop
windowrule=opacity 0.98,org.telegram.desktop
windowrulev2=noblur,title:Media viewer
windowrulev2=opacity 1,title:Media viewer

# Firefox and Chromium
windowrule=noblur,firefox
windowrule=float,title:^(Firefox - Sharing Indicator)$
windowrule=float,title:.*is sharing your screen.
windowrulev2=float,class:firefox,title:Picture-in-Picture
windowrulev2=pin,class:firefox,title:Picture-in-Picture
windowrulev2=size 960 540,class:firefox,title:Picture-in-Picture

# The GTK file-choser renders too big on the laptop screen (the windows is
# bigger than the monitor, so controls are off-screen.
# This picks up all variations of the file picker for firefox, and shrinks it.
# As a bonus, it also grows the window to a larger size if it's too small.
windowrulev2=size 70% 70%,title:File Upload,floating:1
windowrulev2=center,title:File Upload,floating:1

windowrulev2=size 70% 70%,title:Open File,floating:1
windowrulev2=center,title:Open File,floating:1

windowrulev2=size 70% 70%,title:Scegli file,floating:1
windowrulev2=center,title:Scegli file,floating:1

windowrulev2=size 70% 70%,title:Choose Files,floating:1
windowrulev2=center,title:Choose Files,floating:1
windowrulev2=float,title:Choose Files
windowrulev2=size 70% 70%,title:Choose Files

windowrulev2=size 70% 70%,title:Apri file,floating:1
windowrulev2=center,title:Apri file,floating:1
windowrulev2=size 70% 70%,title:Apri cartella,floating:1
windowrulev2=size 70% 70%,title:Open Folder,floating:1
windowrulev2=center,title:Open Folder,floating:1
windowrulev2=size 70% 70%,title:Salva come,floating:1
windowrulev2=size 70% 70%,title:Enter name of file to save toâ€¦,floating:1
windowrulev2=size 70% 70%,title:Save As,floating:1
windowrulev2=center,title:Save As,floating:1
windowrulev2=size 70% 70%,title:Save File,floating:1
windowrulev2=center,title:Save File,floating:1
windowrulev2=size 70% 70%,title:Save Image,floating:1

# }}}

# Bindings {{{

# General {{{

# Terminal 
bind=SUPER,Return,exec,$term
bind=SUPERCTRL,Return,exec,$term -a floating -o include=/usr/share/foot/themes/tokyonight-day -o cursor.color="c0caf5 24283b"

# Menu
bind=SUPER,D,exec,$menu

# TUI
bind=SUPERSHIFT,Return,exec,$term -T lf lf
bind=SUPERCTRL,M,exec,$term --class floating -T pulsemixer pulsemixer
bind=SUPERCTRL,N,exec,$term -T newsboat newsboat
bind=SUPERCTRL,A,exec,$term --class floating -T ncmpcpp ncmpcpp

# GUI
bind=SUPER,B,exec,$browser
bind=SUPERCTRL,T,exec,telegram-desktop

# Dmenu utilities
bind=SUPERSHIFT,Q,exec,wlogout -p layer-shell
bind=SUPERCTRL,P,exec,passmenu
bind=SUPERCTRL,W,exec,wifi -c
bind=SUPERSHIFT,M,exec,dmenumount
bind=SUPERSHIFT,U,exec,dmenuumount

# Lockscreen
bind=SUPER,X,exec,loginctl lock-session

# General actions (toggle fullscreen, floating, ecc)
bind=SUPERSHIFT,W,killactive,
bind=SUPER,S,togglefloating,
bind=SUPER,F,fullscreen,0
bind=SUPER,M,fullscreen,1
bind=SUPER,T,pseudo,

# groups
bind=SUPER,g,togglegroup
bind=SUPER,Tab,changegroupactive

# togglesplit
bind=SUPERCTRL,l,togglesplit

# }}}

# Move and resize {{{

# move focus
bind=SUPER,H,movefocus,l
bind=SUPER,L,movefocus,r
bind=SUPER,K,movefocus,u
bind=SUPER,J,movefocus,d

# move focus to the urgent (or last) window
bind=SUPER,U,focusurgentorlast

# move active
binde=SUPERSHIFT,H,exec,hyprctl --batch 'dispatch movewindow l; dispatch moveactive -30 0'
binde=SUPERSHIFT,L,exec,hyprctl --batch 'dispatch movewindow r; dispatch moveactive 30 0'
binde=SUPERSHIFT,K,exec,hyprctl --batch 'dispatch movewindow u; dispatch moveactive 0 -30'
binde=SUPERSHIFT,J,exec,hyprctl --batch 'dispatch movewindow d; dispatch moveactive 0 30'

# move to workspace
bind=SUPER,1,workspace,1
bind=SUPER,2,workspace,2
bind=SUPER,3,workspace,3
bind=SUPER,4,workspace,4
bind=SUPER,5,workspace,5
bind=SUPER,6,workspace,6
bind=SUPER,7,workspace,7
bind=SUPER,8,workspace,8
bind=SUPER,9,workspace,9
bind=SUPER,0,workspace,10
bind=SUPER,mouse_down,workspace,e+1
bind=SUPER,mouse_up,workspace,e-1

# move focused window to workspace
bind=SUPERSHIFT,1,movetoworkspace,1
bind=SUPERSHIFT,2,movetoworkspace,2
bind=SUPERSHIFT,3,movetoworkspace,3
bind=SUPERSHIFT,4,movetoworkspace,4
bind=SUPERSHIFT,5,movetoworkspace,5
bind=SUPERSHIFT,6,movetoworkspace,6
bind=SUPERSHIFT,7,movetoworkspace,7
bind=SUPERSHIFT,8,movetoworkspace,8
bind=SUPERSHIFT,9,movetoworkspace,9
bind=SUPERSHIFT,0,movetoworkspace,10

# Mouse binds for moving and resizing
bindm=SUPER,mouse:272,movewindow
bind=SUPER,mouse:272,exec,hyprctl keyword dwindle:force_split 0
bindr=SUPER,mouse:272,exec,hyprctl keyword dwindle:force_split 2
bindm=SUPER,mouse:273,resizewindow

# Enter resize mode
bind=SUPER,r,submap,r
submap=r
binde=,h,resizeactive,-40 0
binde=,j,resizeactive,0 40
binde=,k,resizeactive,0 -40
binde=,l,resizeactive,40 0
binde=,escape,submap,reset
submap=reset

# Move the currently focused window to the special workspace (a.k.a. scratchpad)
bind=SUPER,I,movetoworkspacesilent,special:minimize

# Show the next scratchpad window or hide the focused special workspace window.
# If there are multiple special workspace windows, this command cycles through them.
bind=SUPERSHIFT,I,exec,unminimize

# }}}

# Dunstctl {{{

bind=CTRL,SPACE,exec,dunstctl close
bind=CTRLSHIFT,SPACE,exec,dunstctl close-all
bind=CTRLSHIFT,H,exec,dunstctl history-pop
bind=CTRLSHIFT,I,exec,dunstctl action

# }}}

# Screenshot (grimblast) {{{

bind = , Print, exec, hyprshot -m output
bind=SHIFT,PRINT,exec,hyprshot -m output --clipboard-only
bind=CTRL,PRINT,exec,hyprshot -m region
bind=CTRLSHIFT,PRINT,exec,hyprshot -m region --clipboard-only

# }}}

# Env manipulation {{{

bind=SUPERSHIFT,G,exec,~/.config/hypr/scripts/toggle-gaps
bind=SUPERSHIFT,C,exec,~/.config/hypr/scripts/toggle-fancy
bind=SUPERSHIFT,V,exec,gpu-on-off.sh

# }}}

# XF86 (volume, brightness and MPD) {{{

# Wob for volume/brightness
$WOBSOCK=/run/user/1000/wob.sock

# Volume
binde=,XF86AudioRaiseVolume,exec,pamixer -ui 2 && pamixer --get-volume > $WOBSOCK
binde=,XF86AudioLowerVolume,exec,pamixer -ud 2 && pamixer --get-volume > $WOBSOCK
bind=,XF86AudioMute,exec,pamixer --toggle-mute && ( pamixer --get-mute && echo 0 > $WOBSOCK ) || pamixer --get-volume > $WOBSOCK
bind=,XF86AudioMicMute,exec,pactl set-source-mute @DEFAULT_SOURCE@ toggle

# Brightness
binde=,XF86MonBrightnessDown,exec,brightnessctl set 5%- | sed -En 's/.*\(([0-9]+)%\).*/\1/p' > $WOBSOCK
binde=,XF86MonBrightnessUp,exec,brightnessctl set +5% | sed -En 's/.*\(([0-9]+)%\).*/\1/p' > $WOBSOCK

# MPD
bind=,XF86AudioPlay,exec,playerctl play-pause
bind=,XF86AudioNext,exec,playerctl next && ~/.config/ncmpcpp/notification
bind=,XF86AudioPrev,exec,playerctl previous && ~/.config/ncmpcpp/notification
bind=,XF86AudioStop,exec,mpc stop
bind=,XF86AudioPause,exec,mpc play-pause

# }}}

# }}}

# Clipman configuration {{{

bind = SUPER, C, exec, cliphist list | rofi -dmenu -theme launcher | cliphist decode | wl-copy
exec-once = wl-paste --type text --watch cliphist store #Stores only text data

exec-once = wl-paste --type image --watch cliphist store #Stores only image data

# }}}

# lid open/close binding {{{
bindl=,switch:Lid Switch,exec,lid
# }}}

# set wallpaper {{{

exec-once=swww init
exec-once=sleep 1; /home/davide/.local/bin/setbg /home/davide/pics/wallpapers

# }}}

# vim:fileencoding=utf-8:ft=conf:foldmethod=marker
