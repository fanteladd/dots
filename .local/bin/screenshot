#!/bin/sh
# Screenshot: script for making screenshots.
# Screenshots can be taken by area or fullscreen and can be saved as png or copied to the clipboard.

DIR="$HOME/pics/screenshots"
DATE="$(date +%Y%m%d-%H%M%S)"
NAME="$DIR/screenshot-$DATE.png"
TEMP="/tmp/screenshot.png"

alias maims='maim --noopengl --capturebackground --select --hidecursor'

# Check if the dir to store the screenshots exists, else create it
if [ ! -d "$DIR" ]; then mkdir -p "$DIR"; fi

# Notify
notify() {
    dunstify -h string:c-dunst-stack-tag:screenshot "ðŸ“¸ screenshot taken" "$1"  -i "$1"
}

# Screenshot a selected area (or the selected window)
area() {
    if maims "$1"; then
        notify "$1"
    fi
}

# Screenshot the entire screen
fullscreen() {
    if maim --noopengl "$1"; then
        notify "$1"
    fi
}

# Copy screenshot on clipboard
clip() {
    xclip -selection c -filter -t image/png -i "$1"
}

# Parsiong options
for arg in "$@"; do
  shift
  case "$arg" in
    "--help") set -- "$@" "-h" ;;
    "--copy") set -- "$@" "-c" ;;
    "--area") set -- "$@" "-a" ;;
    *)        set -- "$@" "$arg"
  esac
done
shift "$(($OPTIND -1))"

while getopts "hca" o; do case "${o}" in
    a) area="True" ;;
    c) copy="True" ;;
    *) printf "Options:\\n   -a, --area: Make a screenshot of the selected area.\\n   -c, --copy: Save the screenshot in clipboard\\n" && exit 1 ;;
esac done

if [ -n "$copy" ]; then
    save="$TEMP"
    if [ -n "$area" ]; then
        area "$save"
    else
        fullscreen "$save"
    fi
    clip "$TEMP"
else
    save="$NAME"
    if [ -n "$area" ]; then
        area "$save"
    else
        fullscreen "$save"
    fi
fi
