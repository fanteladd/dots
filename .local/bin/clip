#!/bin/sh

menu(){
    printf "1. [URL] Get a shorten url\n"
    printf "2. [URL] Download file in ~/dloads\n"
    printf "3. [URL] Play videos in mpv\n"
    printf "4. [Image] Save clipbaord image in ~/pics\n"
    printf "5. [Shell] This will run any shell command\n"
}

spell_failed(){
    notify-send "Failed to cast spell"
}

choice=$(menu | dmenu -p "Clipboard:" -theme dark-dmenu | cut -d. -f1)
cbtext=$(wl-paste -n)

case "$choice" in
    1)
    output=$(curl -s -F"shorten=$cbtext" 0x0.st)
    if [ "$output" = "Segmentation Fault" ]; then
        spell_failed
    else
        echo "$output" | xclip -selection c
        notify-send "Shorten Link is in Clipboard"
    fi
    exit
    ;;
    2)
    (wget -P ~/dloads "$cbtext" &&
        notify-send "Downloading File") ||
            spell_failed
    exit
    ;;
    3)
    setsid -f -- mpv "$cbtext" || spell_failed
    exit
    ;;
    4)
    file=$(date +"%Y_%m_%d_%I_%M_%p")
    xclip -selection clipboard -t image/png -o > "$HOME/pics/$file.png" ||
        spell_failed
    exit
    ;;
    5)
    "$cbtext" || spell_failed
    exit
    ;;
esac
